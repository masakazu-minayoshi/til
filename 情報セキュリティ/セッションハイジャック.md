# セッションハイジャック  
## セッションハイジャックとは?  
* なんらかの方法を用いて正規利用者ではないものが他人のセッションIDを乗っ取る攻撃手法。  
### 想定される被害  
アプリケーション内で正規の利用者ができることはほとんど実行が可能なので、正規利用者への被害はとても大きくなる。  
* 正規利用者の個人情報閲覧  
* 送金や物品購入  
* なりすましメールの送信やSNSへの犯罪予告など  
### セッションハイジャックの攻撃手法  
具体的な攻撃手法としては以下の3つが挙げられる。  
(1)セッションIDの推測  
(2)セッションIDの盗み出し  
(3)セッションIDの強制  
### セッションハイジャックの対策   
#### セッションIDの推測    
* Webアプリケーションに用いられるセッションIDの生成規則に問題があると、<br>第三者にセッションIDが予測され、悪用されてしまう可能性がある。  
* 生成規則に問題があるセッションIDは以下のようなものを元に生成されているものが多い。  
○ユーザIDやメールアドレス  
○リモートIPアドレス  
○日時  
○乱数  
* ユーザIDや日時は外部から参照可能なためセッションIDを推測することができる。  
[![Image from Gyazo](https://i.gyazo.com/3140c7626425b79ccb89d4965b87bdbe.png)](https://gyazo.com/3140c7626425b79ccb89d4965b87bdbe)
* 測可能なセッションIDの生成を回避するためには、<br>Webアプリケーション開発ツールが持つセッション管理機構を利用することが安全とされている。  
* 主要なアプリケーション開発ツールのセッション管理機構に脆弱性が発見された場合、<br>セキュリティ研究者によって指摘されすぐに改善されることが見込まれる。  
* だから、セッションIDの生成は独自の機構で行うのではなく、<br>開発ツールによるものにするとセッションIDを推測されることはほとんどなくなる。  
#### セッションIDの盗み出し  
* セキュリティに不備のあるネットワークではセッションIDとして利用されるcookieを盗聴されてしまう可能性がある。  
(例)暗号化されていない無線LAN  
* ※SSLを用いてネットワークを暗号化するプロトコルを利用することでセッションIDの盗聴を防ぐ。  
→セッションIDの盗聴を防ぐためには通信経路を意識することも重要である。
※**SSL(Secure Socket Layer)**:インターネット上の通信を暗号化してくれる技術  
* 第三者からの情報の盗聴や改ざんを防ぐことができる。  
その結果、セッションIDのような重要な情報をやりとりする際はSSLを使うと機密性・完全性を保つことができる。  

#### セッションIDの強制   
セッションIDを悪意のある第三者が外部から強制させる方法を「**セッションIDの固定化**」という。  
* セッションIDの固定化は以下の手順  
(1)悪意のある第三者は普通の利用者としてセッションID(abc123)を取得  
(2)被害者に対して1.で取得したセッションIDを強制  
(3)被害者は標的アプリケーションにログイン  
(4)悪意のある第三者は、被害者に強制したセッションID(abc123)を使って標的アプリケーションにアクセスする  
[![Image from Gyazo](https://i.gyazo.com/379d7b9b7c723d8da033854609bd8c39.png)](https://gyazo.com/379d7b9b7c723d8da033854609bd8c39)
* セッションIDとは利用者の状態を保持するために使われる。  
* 被害者は悪意のある第三者が強制したセッションIDで認証が完了すると、<br>そのセッションIDを用いてアクセスした悪意のある第三者はすでに認証済みのページにアクセスすることができる。  
[![Image from Gyazo](https://i.gyazo.com/06df44088974bf30ddc5644d8dd6ee8f.png)](https://gyazo.com/06df44088974bf30ddc5644d8dd6ee8f)
* セッションIDを固定する方法は多種多様。  
Webアプリケーション側でセッションIDの固定化攻撃に対策する方法として、<br>認証が完了した時点でセッションIDを変更するという方法がある。  
[その結果]  
認証前にセッションIDが固定されたとしても、  
認証後にセッションIDが変わるため固定されたセッションIDでアクセスしようと試みる悪意のある第三者は認証されない。  


> 参考  
[セッションID固定化攻撃とは？仕組みから対策方法まで徹底解説](https://cybersecurity-jp.com/cyber-terrorism/34700)
