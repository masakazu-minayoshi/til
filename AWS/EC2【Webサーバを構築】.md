# EC2【Webサーバを構築】  
## EC2とは何？  
* Elastic Compute Cloudの略でAWSクラウド上の仮想サーバーのこと。<br>インスタンスというのはEC２から立てられたサーバーのこと。  
### 特徴  
* 数分で起動し1時間または秒単位の従量課金。  
* サーバーの追加・削除・マシンスペック変更も数分でできる。  
* OSよりも上のレイヤについては自由に設定できる。  
### 作成手順  
①AMI(Amazon Machine Image)の選択  
* **インスタンス起動に必要な情報が入ったOSのイメージ**。<br>**サーバーのテンプレートのようなモノ**。    
* 特徴  
・AWSやサードパーティがAMIを提供。  
・自前のカスタムAMIも作成ができる。  
・カスタムAMIから何台でもEC2インスタンスを起動することができる。  
②インスタンスタイプの選択  
* インスタンスタイプ：**サーバーのスペックを定義したモノ**。  
* 概要  
・インスタンスタイプにより、「CPU、メモリ、ストレージ、ネットワーク帯域」などが異なる。  
・インスタンスタイプにより料金が異なる。スペックが高いほど料金も高い。  
・アクセス数などに応じて必要なスペックのなるインスタンス対鵜を選択する。  
[![Image from Gyazo](https://i.gyazo.com/97e7172e580b65639442a9ada0c1342a.png)](https://gyazo.com/97e7172e580b65639442a9ada0c1342a)
③ストレージの追加  
* ストレージ：**サーバーにくっつけるデータの保存場所。**<br>EC2のストレージには２種類ある。  

|**EBS(Elastic Block Store)**|インスタンスストア|
|:--------------------------:|:------------|
|高井可用性と耐久性を持つストレージ|インスタンス専用の一時的なストレージ|
|他のインスタンスに付け替えできる|他のインスタンスに<br>付け替えることができない|
|EC2インスタンスをStop/Terminateしても<r>EBSは保存可能|EC2インスタンスを<br>Stop/Terminateするとクリアされる|
|Snapshotを取得しS3に保存ができる|追加費用なし（無料）|
|EBSの費用が別途発生|なくなってはいけないデータは置かない|
|OSやDBなどの永続性と耐久性が必要なデータを置く|一次ファイル、キャッシュなど<br>なくなっても問題がないデータを置く| 

#### EC2インスタンス作成の手順  
①ルートユーザーでログインし、EC2のサービスを選択。<br>ダッシュボード内のインスタンスを選択し、インスタンスの作成をクリック。  
②クイックスタートの「Amazon Linux 2 AMI (HVM), SSD Volume Type」を選択。<br>※AWSによってメンテナンスされており、<br>AWSの各サービスと連携できるツールやライブライが最初から入っていてすぐに使用できる。
[![Image from Gyazo](https://i.gyazo.com/ffb1fbea34c716d57f32a48c1a9bf99d.png)](https://gyazo.com/ffb1fbea34c716d57f32a48c1a9bf99d)
③インスタンスのタイプを選択。<br>特にこだわりがなければ「t2.micro」選択し、「次のステップ：インスタンスの詳細の設定」をクリック。  
[![Image from Gyazo](https://i.gyazo.com/88c15e0ea278c7e01a2af19fd4b34756.png)](https://gyazo.com/88c15e0ea278c7e01a2af19fd4b34756)
④インスタンスの詳細の設定  
必要事項を記入し「次のステップ：ストレージの追加」をクリック。  
* インスタンス数：起動するインスタンスの数。  
* ネットワーク：起動したVCPを利用した時は該当のVPCを選択。  
* 自動割り当てパブリック IP：インタネット経由でアクセスできるグローバルIPアドレスをつけるかどうかを選択する。<br>インターネットからアクセスできるようにするなら有効を選択。    
* 配置グループ：複数のEC2インスタンス間の通信を高速化する機能。  
* キャパシティーの予約  
・AWSではアベイラビリティーゾーンごとにリソースの上限が決まっている。<br>上限を超えるとEC2インスタンスが起動できなくなる。  
・キャパシティ予約すると事前に要領を確保してくれる。<br>しかし、EC2に使用の有無に関わらず料金が発生する。    
* IAMロール：EC2インスタンスが他のAWSサービスと連携する際の権限のこと。  
* インスタンスをシャットダウンした時に起動できるように、停止にするか削除するかを選択する。  
* Elastic Inference：機械学習でGPUを使用する際にコストパフォーマンスをよくする機能。  
* ネットワークインターフェイス<br>publicだけでなくprivateIPアドレスも記入できる。<br>※publicIPアドレスの範囲内で設定する。  
⑤ストレージの追加  
必要に応じて内容を変えて「次の手順：タグの追加」をクリック。  
[![Image from Gyazo](https://i.gyazo.com/91af1e1d393a5f1947d63ce52439144d.png)](https://gyazo.com/91af1e1d393a5f1947d63ce52439144d)
* ボリュームタイプ  
・ルート：OSが入っているストレージ。AMIの選択時に決まっている。    
・追加時にはEBSかインスタンスストアかを選択することができる。  
* デバイス  
・OSから見えるデバイスの名前。    
・ルートの時は最初から決まっている。EBSかインスタンスストアかを選択する時はデバイスも選択できる。  
* ルートの時は決まっていて、EBSの時は選択することができる。  
* ボリュームタイプ  
ルートかEBSの時に選択することができる。  
・汎用SSD：価格と性能のバランスがとれていてよく使われる。  
・プロビジョンド IOPS SSD：データベースなど高いio（デバイスへの入出力）が必要な時に使われる。  
・マグネティック：低いioの時でも問題がない時に使う。  
* IOPS：プロビジョンドの時だけ選択することができる。  
* スループット：１秒間のデータ転送速度。  
* 合わせて削除：課金を避ける時はチェックする。  
* 暗号化：EBSボリュームの際の暗号化。  
⑤タグの追加  
インスタンスに付与するタグを設定する。<br>必要事項を記入したら「次の手順：セキュリティグループの設定」をクリック。   
[![Image from Gyazo](https://i.gyazo.com/a7818149cab84b0aed6537c6c07e24df.png)](https://gyazo.com/a7818149cab84b0aed6537c6c07e24df)
⑥セキュリティグループの設定
インスタンスへのセキュリティを設定する。  
⑦インスタンス作成の確認。  
・記入内容を確認し起動をクリック。  
・既存のキーペアを選択するか、新しいキーペアを作成するかを選択し必要事項を記入する。  
・キーペアのダウンロードをクリック。再度、ダウンロードができないので保存する。  
## SSHとは？  
### SSHでサーバーにログインする  
* サーバーにログインするとはどういう意味？<br>→（離れた場所にある）」サーバーに入って、自分のパソコンから操作すること。  
* SSHとは？  
・**サーバーと自分の目の前のパソコンをセキュアに繋ぐサービス**のこと。  
・通信内容が暗号化された遠隔ログインシステム。  
[![Image from Gyazo](https://i.gyazo.com/f68f5ff617fac58dd2b926ad9bc44d1a.png)](https://gyazo.com/f68f5ff617fac58dd2b926ad9bc44d1a)
## 公開鍵認証とは？  
誰でもサーバーに入れるとセキュリティ上問題がある。<br>EC2ではサーバーの作成者本人だけがログインできるようにSSHログイン時に**公開鍵認証**
を行っている。  
* 公開鍵認証とは？  
・サーバへのログイン時に認証を行う仕組み。  
・ユーザー名とパスワードを使用した認証と比べ、よりセキュリティが高い。  
・公開鍵暗号（秘密鍵と公開鍵）を用いて認証を行う。  
・公開鍵はサーバーが保有。秘密鍵(pemファイル)を持っているユーザーだけがログインができる。  
[![Image from Gyazo](https://i.gyazo.com/7f7942dd3ee5650948cff9c26a7c501c.png)](https://gyazo.com/7f7942dd3ee5650948cff9c26a7c501c)
### 暗号  
他人には内容がわからないようにしてメッセージのやり取りを行うこと。  
* 公開鍵暗号は南京錠でイメージする。<br>→つまり、南京錠（公開鍵）と南京錠の鍵（秘密鍵）」のセットが必要。  
### 具体的な手順  

|ステップ|自分のコンピュータ<br>秘密鍵を保有|サーバー<br>公開鍵を保有|
|:----:|:-----------:|:-----:|
|①|ログインさせて！→||
|②||←適当なデータを公開鍵で暗号化して送るよ！|
|③|秘密鍵で復元したデータ送るよ！→||
|④||←元のデータと合っていたからログインしていいよ！|







