# ドメイン  
## ドメインとは？  
・インターネット上の住所みたいなもの。<br>→インターネット上に存在するコンピュータやネットワークを識別するための名前。  
### ドメインのメリット  

|IPアドレス|**ドメイン**|
|:-----:|:-----|
|数字の列|文字列|
|93.184.216.34|example.com|
|覚えづらい|覚えやすい|

### ドメイン名の構造  
・ドメイン名はピリオドで区切られた構造をしている。  
・**各レベルのドメインは同じドメインは登録できないuniqueの性質がある**。
[![Image from Gyazo](https://i.gyazo.com/0329b2d82fa61f30784a3ae1b156e76f.png)](https://gyazo.com/0329b2d82fa61f30784a3ae1b156e76f)

### ドメインを管理しているのは誰？  

||役割|具体的な組織|
|:--:|:---:|:---:|
|ICANN|ドメイン全体を管理|ICANN|
|||↓任命|
|レジストリ|・トップレベルドメインを管理<br>・レジストらに卸す|・JPRS(.js)<br>・Versign(.com/.ne)<br>・Public Interset Registry(.org)|
|||↓ドメインを卸す|
|レジストラ|・リセラに卸す<br>・一般消費者に販売|お名前.comなど|
|||↓ドメインを卸す|
|リセラ|再販事業者<br>一般消費者に販売|・Yahoo!ドメイン<br>VALUE-DOMAIN|

## DNS
webサイトをみるためにはドメインを購入するだけでは見ることができない。<br>**ドメインとサーバー（IPアドレス）をDNSで紐づける必要がある**。  

|DNS<br>(Domain Name System)|・ドメイン名の管理システム<br>・ドメイン名をIPアドレスに変換する<br>・ネームサーバとフルリゾルバの2つから構成される|
|:------:|:----------|
|ネームサーバー|・ドメイン名とそれに紐づくIPアドレスが登録されるサーバー<br>・ドメインの階層ごとにネームサーバーが配置され、<br>そのサーバーが配置された階層のドメインに関する情報を管理する|
|フルリゾルバ|「どのドメインに紐づくIPアドレスを教えて」と問い合わせると、<br>いろいろなネームサーバーに聞いてIPアドレスを調べて教えてくれるサーバー|

## DNSはIPアドレス以外も管理している  
* **リソースレコード**：DNSの「ドメイン名とIPアドレスの紐付け」の一つ一つのこと。

|リソースレコードのタイプ|内容|
|:---------------:|:---|
|Aレコード|ドメインに紐づくIPアドレス|
|NSレコード|ドメインのゾーンを管理するネームサーバー|
|**MXレコード**|ドメインに紐づくメール受信サーバー|
|CNAME|ドメインの別名でリソースレコードの参照先|
|SOA|ドメインのゾーンの管理情報|

### ドメインの購入について  
迷ったら「お名前.com」の選択がベターかも。  

|選ぶポイント|お名前.com|
|:------|:--------|
|・価格は1年目だけでなく2年目以降も確認<br>・管理画面の使いやすさや設定変更の反応の早さ<br>・無料オプションの充実度|・国内最大のレジストラ<br>・580種類以上のドメインの取り扱い<br>・累計登録実績2,000万件|

### ドメイン登録時の注意点  
* 1年の自動更新設定は解除しておく。  

## Route53とは？  
AWSのDNSサービスでネームサーバーの役割を果たす。  

|特徴|重要概念|
|:--|:------|
|高可用性（システムが継続して稼動できる能力）<br>・SAL100%（定義した可用性よりもAWSが機能する）|ホストゾーン<br>・DNSのリソースレコードの集合。<br>ゾーンファイルのようなもの。|
|高速<br>・エッジロケーションの中で<br>最も近いロケーションから応答を返す。|レコードセット<br>・リソースレコードのこと。|
|フルマネージドサービス<br>・DNSサーバーの設計・構築・維持管理が不要。|ルーティングポリシー<br>・Route53がRecord Setに対して<br>どのようにルーティングを行うかを決める|
||ヘルスチェック<br>・サーバーの稼働状況をチェック|

### ルーティングポリシー  
* ルーティングポリシー：Route53がレコードセットに対して、どのようにルーティングを行うかを決める。 

|内容|詳細|
|:--|:--|
|シンプル|・レコードセットで事前設定された値に基づき、ドメインへの問い合わせに応答する。<br>・最初はこちらを使用することが多い。|
|加重|・複数エンドポイントごとに設定された重みに基づき、ドメインへの問い合わせに応答する。<br>・提供リソースに差がある場合やABテスト時に使用|
|レイテンシー|・リージョン間の遅延が少ない方のリソースへルーティングする。<br>・マルチリージョンにリソースが存在する場合に使用。|
|位置情報|・クライアントの位置情報に基づいて、ドメインへの問い合わせに応答する。<br>・コンテンツのローカライズや地域限定配信時に使用。|
|フェイルオーバー|・ヘルスチェックの結果に基づいて、利用可能なリソースへルーティングする。<br>(ヘルスチェック：サーバーの稼働状態をチェックすること)<br>・障害発生時にSorryサーバーに簡単に切り替えられる。|

### 他サイト（お名前.comなど）でドメインを取得してRoute53でDNSを設定する場合  
* (手順)ドメインのネームサーバーをRoute５３に変更  
①サービスからRoute53のダッシュボードを開きDNSの今すぐ管理を選択しホストゾーンの作成をクリックし作成する。  
※タイプはパブリックホストゾーン（インターネットからそのドメインを選択する時）を選択。
[![Image from Gyazo](https://i.gyazo.com/d9a6686bcd014fda5412f732f18aff6b.gif)](https://gyazo.com/d9a6686bcd014fda5412f732f18aff6b)
②NSレコード（メインのゾーンを管理するネームサーバーとの紐付け）と(ドメインのゾーンの管理情報)が作成される。
[![Image from Gyazo](https://i.gyazo.com/27d29cf58d6cee706bac1b6fcb51af32.png)](https://gyazo.com/27d29cf58d6cee706bac1b6fcb51af32)
③EC2のインスタンスへ遷移しEC2が起動(runnning)かを確認する。  
※起動していない時は「アクション」→「インスタンスの状態」→「開始」で起動できる。  
Elastic IPを使用するので解放している時は新しいアドレスの割り当てを行う。   
「Elastic IP」→「新しいアドレスの割り当て」→「アドレス」<br>→「アドレスの関連付け」でインスタンスとプライベートIPなど選択。  
④Elastic IPを使ってターミナルでSSHにログインしネームサーバーを確認。  
（ターミナルで）% dig aws-and-infra.work NS +short  
* dig：ドメインに紐づくIPアドレスやIPアドレスに紐づくドメインを調べる際に使用するコマンド。  
* NS：ネームサーバーを指定したい時に入力。  
* +short：ネームサーバーだけ知りたい時に指定する。  
⑤ネームサーバを取得したサイト先で名称変更手続きをする。  
* (手順)：ドメインに紐づくIPアドレスを登録  
・Route53でAレコードセットを作成  
①AWSの・Route53ダッシュボード内のメニューのホストゾーンをクリックし、レコードセットの作成をクリック。  
※値：Elastic IPアドレスを入力する。  
②ドメイン名の変更が完了したらターミナルでSSHにログインし名前を確認する。(上記④の手順参照)














